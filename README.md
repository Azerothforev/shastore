# Shastore-project-API


### Технологии
`FastApi` `Rabbitmq (aio-pika)` `SQLAlchemy` `Pydantic` `PostgresSQL (asyncpg)` `Alembic (async)`

## Описание
```
приложение - реализация ресейл системы для возможности купли/продажи Люксовых вещей и акссесуаров среди пользователей.

Приложение состоит из трех сервисов:

	Сервис авторизации и аутентификации(auth):
	Генерация JWT токена, который хранится и достается из cookie
	Хэширование всех паролей по алгоритму HS256

	Сервис Shastore-API:
	Полностью асинхронный сервис, который связывается с postgre через асинхронный драйвер, а также rabbitmq через aio-pika
	GET/POST/DELETE/UPDATE запросы реализованы с помощью ORM sqlalchemy 2.0

	Сервис mail:
	Асинхронная отправка сообщений на почту покупки товара/Успешной регистрации пользователя/Смены пароля(приходит токен, что надо вставить при POST запросе)

Сервис авторизации и сервис shastore выступая producer'ами отправляют сообщения в обменник rabbitmq, откуда сообщения распределяется по очередям routing_key.
В качестве обменника выступает topic exchange, сама идея его использования будет проявляться при масштабированнии.
consumer'ом выступает сервис mail.
```

##### Локальный запуск приложения.
```angular2html

создайте файл .env и опишите внутри него переменные для rabbitmq, postgresql, jwt-token, а также логин/пароль приложения для отправки писем по gmail:
		POSTGRES_HOST=хост для подключения к постгре(по дефолту localhost). Вимание! Для корректной работы в докере вы должны прописать сюда название вашего db из докера
		POSTGRES_PORT=порт для подключения к постргре
		POSTGRES_DB=название базы данных для подключения к постргре
		POSTGRES_USER=пользователь постргре
		POSTGRES_PASSWORD=пароль для подключения к постргре
		SENDER_EMAIL=емейл с которого будут отправляться сообщения
		SENDER_PASSWORD=пароль с которого будут отправляться сообщения(нужен именно пароль приложения, посмотрите, пожалуйста как его получить прочитав пару статей)
		SECRET=создание токена для сервиса auth
		RABBITMQ_USER=пользователь rabbitmq
		RABBITMQ_PASS=пароль для входа в rabbitmq
		RABBITMQ_HOST=хост для подключения к rabbitmq(по дефолту localhost). Внимание! Для корректной работы в докере вы должны прописать сюда название вашего rabbitmq из докера 
```
	1. установите зависимости в головной директории используя команду
		pip install -r requirements.txt

**_установите зависимости в головной директории используя команду_**
```
pip install -r requirements.txt
```

**_сделайте миграции_**
```
cоздайте внутри папки src/migrations директорию versions, где будут создаваться миграции alembic
а затем выполните миграции в директории src используя команду
	alembic revision --autogenerate -m "ваш комментарий"
```


**_Запуск проекта в докере_**
```
поднимите все контейнеры в сети через docker-compose.yaml:
	docker-compose up --build
	docker-compose up -d --build *запустите в режиме демона, если не хотите видеть логов и освободить терминал

Помните, что вы разворачиваете на локалке и для реального прода вам нужно переписать docker-compose или же создать новый
```


###### Dmitry Shalenko